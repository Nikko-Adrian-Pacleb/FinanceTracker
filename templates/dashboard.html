{% extends "index.html" %}
{% block title %} Dashboard {% endblock %}
{% block content %}
    <div class="row">
      <div class="col-6">
        <h1 align="center"> Overview </h1>
        <div class="row">
          <div class="box" id="chart-container">
            <svg id="chart"></svg>
          </div>
        </div>
        <div class="row">
          <div class="col small-box">Past Week</div>
          <div class="col small-box">Past Month</div>
          <div class="col small-box">Past Year</div>
        </div>
        <div class="row">
          <div class="col small-box">Recent Gains</div>
          <div class="col small-box">Recent Declines</div>
          <div class="col small-box">Anything</div>
        </div>
      </div>
      <div class="col-6">
        <h1 align="center"> Entries </h1>
        <form method="POST" action="/submit">
          <div class="row">
              <div class="col-8 no-padding right-padding">
                  <input name="title" id="title" class="form-control" placeholder="Type Entry">
              </div>
            <div class="col-2 no-padding right-padding">
                <input name="amount" id="amount" type="number" class="form-control" placeholder="Amount">
            </div>
            <div class="col-2 no-padding">
                <input name="date" id="date" class="form-control" placeholder="Date">
            </div>
          </div>
            <div class="row">
              <button type="submit" class="btn btn-primary add-button" align="right"> Add </button>
            </div>
        </form>
        <div class="row">
          <table class="table table-hover table-dark">
            <thead>
                <tr>
                    <!-- Your Columns HERE -->
                    <th scope="col-1">ID</th>
                    <th scope="col-7">Title</th>
                    <th scope="col-2">Amount</th>
                    <th scope="col-2">Date</th>
                </tr>
            </thead>
            <div id="transactions">
              <h3>Transaction History</h3>
              <tbody>
                {% for transaction in transactions %}
                  <div class="transaction">
                    <tr>
                        <td> {{ transaction.id }} </td>
                        <td> {{ transaction.title }} </td>
                        <td> {{ transaction.amount }} </td>
                        <td> {{ transaction.transactionDate }} </td>
                    </tr>
                  </div>
                {% endfor %}
              </tbody>
            </div>
          </table>
        </div>
        </div>
      </div>
    </div>

<script>
  // Fetch data from Flask endpoint
  d3.json('/get_data')
      .then(function(data) {
          // Create a color scale
          var color = d3.scaleOrdinal(d3.schemeCategory10);

          // Create an SVG element
          var svg = d3.select('#chart');

          // Get the dimensions of the container
          var containerWidth = document.getElementById('chart-container').offsetWidth;
          var containerHeight = document.getElementById('chart-container').offsetHeight;

          // Set the dimensions of the SVG based on the container's size
          svg.attr('width', containerWidth)
              .attr('height', containerHeight);

          // Calculate the radius based on the smaller dimension (width or height)
          var radius = Math.min(containerWidth, containerHeight) / 2;

          // Create a pie chart layout
          var pie = d3.pie()
              .value(function(d) { return d.value; });

          // Generate arcs for the pie slices
          var arc = d3.arc()
              .outerRadius(radius)
              .innerRadius(0);

          // Create a group element for the pie chart and center it in the SVG
          var chartGroup = svg.append('g')
              .attr('transform', 'translate(' + containerWidth / 2 + ',' + containerHeight / 2 + ')');

          // Create pie slices
          var arcs = chartGroup.selectAll('arc')
              .data(pie(data))
              .enter()
              .append('g');

          // Draw the pie slices
          arcs.append('path')
              .attr('d', arc)
              .attr('fill', function(d) { return color(d.data.label); });

          // Add labels to the pie slices
          arcs.append('text')
              .attr('transform', function(d) { return 'translate(' + arc.centroid(d) + ')'; })
              .attr('text-anchor', 'middle')
              .text(function(d) { return d.data.label; });
      });
</script>
{% endblock %}

